<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
<head> 
    <title>Getting Started: Handling Form Submission</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<script src="view.js"></script>


<body>
    <!-- <input type="button" value="Generate a table." onclick="generate_table()">
    <INPUT type="button" value="get JAVA array (as a string)" onClick = "getJavaArrayAsAString()"> -->

    <div class="container mt-3">
      <h1>Spots Available</h1>
      <table class="table table-dark">
        <thead>
          <th>Sno</th>
          <th>Name</th>
          <th>Location</th>
          <th>Number of Slots for SUV</th>
          <th>Number of Slots for Hatchback</th>
        </thead>
        <tbody id = "tbody1"></tbody>
      </table>
    </div>

</body>



<script type="module">

  var stdNo = 0;
  var tbody = document.getElementById('tbody1');

  function AddItemsToTable(name, location, suv,hatch){
    let trow = document.createElement("tr");
    let td1 = document.createElement('td');
    let td2 = document.createElement('td');
    let td3 = document.createElement('td');
    let td4 = document.createElement('td');
    let td5 = document.createElement('td');
    
    td1.innerHTML = ++stdNo;
    td2.innerHTML = name;
    td3.innerHTML = location;
    td4.innerHTML = suv;
    td5.innerHTML = hatch;
    

    trow.appendChild(td1);
    trow.appendChild(td2);
    trow.appendChild(td3);
    trow.appendChild(td4);
    trow.appendChild(td5);

    tbody.appendChild(trow);

  }

  function AddAllItemsToTable(spots){
    stdNo = 0;
    tbody.innerHTML="";
    spots.forEach(element => {
      AddItemsToTable(element.name, element.location, element.suv,element.hatch);
      // // console.log(element.hour);
      // console.log(element.hour[0].space_1[0]);
      // console.log(element.hour[0].space_1[2].services[1]);
      console.log(element)
    })
  }


  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-analytics.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyBTrQLmG73loEPd8Kg6uV4ZG01RnUdZ7rI",
    authDomain: "trial-6b9c1.firebaseapp.com",
    databaseURL: "https://trial-6b9c1-default-rtdb.firebaseio.com",
    projectId: "trial-6b9c1",
    storageBucket: "trial-6b9c1.appspot.com",
    messagingSenderId: "192488287455",
    appId: "1:192488287455:web:9edc9a178b1ec23f578d6a",
    measurementId: "G-N4RJLP15EL"
  };

  
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  import {
    getFirestore, doc, getDoc, getDocs, onSnapshot, collection
  } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-firestore.js";

  const db = getFirestore();

  async function GetAllDataOnce(){
    const querySnapshot = await getDocs(collection(db, "Spots"));

    var spots = [];

    querySnapshot.forEach(doc => {
      spots.push(doc.data());
    });

    AddAllItemsToTable(spots);
    
    // console.log(slots);
  }

  function GetAllDataRealTime(){
    const dbRef = collection(db, "Spots");

    onSnapshot(dbRef, (querySnapshot)=> {
      var spots = [];

      querySnapshot.forEach(doc => {
        spots.push(doc.data());
      });
      AddAllItemsToTable(spots);
    })

  }

  window.onload = GetAllDataRealTime;


</script>




</html>
